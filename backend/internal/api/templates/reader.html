{{define "content"}}
<div class="container">
  <div class="reader-header">
    <a href="/" class="back-link">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M19 12H5M12 19l-7-7 7-7"/>
      </svg>
      Back to Articles
    </a>
    
    <h1>{{.Article.Title}}</h1>
    
    <div class="article-meta">
      <span class="source">{{if .Article.FeedName}}{{.Article.FeedName}}{{else}}Unknown{{end}}</span>
      <span class="reading-time">{{.Article.ReadingTime}} min read</span>
      {{if .Article.QualityRank}}
      <span class="score{{if ge .Article.QualityRank 80}} high{{else if ge .Article.QualityRank 60}} mid{{end}}">{{.Article.QualityRank}}</span>
      {{end}}
      <span class="date">{{.Article.FormattedDate}}</span>
    </div>
    
    {{if .Article.Tags}}
    <div class="tags">
      {{range .Article.Tags}}
      <span class="tag">{{.}}</span>
      {{end}}
    </div>
    {{end}}
    
    {{if .Article.Summary}}
    <div class="summary-box">
      <p>{{.Article.Summary}}</p>
    </div>
    {{end}}
    
    <div class="reader-actions">
      <button onclick="openArticle('{{.Article.URL}}')" class="btn btn-primary">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/>
          <polyline points="15 3 21 3 21 9"/>
          <line x1="10" y1="14" x2="21" y2="3"/>
        </svg>
        Read on Original Site
      </button>
      {{if .Article.IsRead}}
      <button class="action-btn" onclick="markUnread({{.Article.ID}})" title="Mark as unread">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10"/>
          <path d="M12 8v8M8 12h8"/>
        </svg>
        Unread
      </button>
      {{else}}
      <button class="action-btn" onclick="markRead({{.Article.ID}})" title="Mark as done">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M20 6L9 17l-5-5"/>
        </svg>
        Done
      </button>
      {{end}}
      <button class="action-btn {{if .Article.ReadLater}}saved{{end}}" onclick="toggleSave({{.Article.ID}})" title="Save forever">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="{{if .Article.ReadLater}}currentColor{{else}}none{{end}}" stroke="currentColor" stroke-width="2">
          <path d="M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"/>
        </svg>
        Save
      </button>
      <button class="action-btn dismiss" onclick="dismissArticle({{.Article.ID}})" title="Not interested">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="18" y1="6" x2="6" y2="18"/>
          <line x1="6" y1="6" x2="18" y2="18"/>
        </svg>
        Dismiss
      </button>
    </div>
  </div>
</div>

<script>
function openArticle(url) {
  // Open article in new tab
  window.open(url, '_blank', 'noopener,noreferrer');
  // Redirect current page back to home
  setTimeout(function() {
    window.location.href = '/';
  }, 300);
}

function markRead(id) {
  fetch('/api/articles/' + id + '/read', { method: 'POST' })
    .then(function(res) {
      if (res.ok) {
        window.location.href = '/';
      }
    });
}

function markUnread(id) {
  fetch('/api/articles/' + id + '/unread', { method: 'POST' })
    .then(function(res) {
      if (res.ok) {
        window.location.href = '/';
      }
    });
}

function toggleSave(id) {
  fetch('/api/articles/' + id + '/save', { method: 'POST' })
    .then(function(res) { return res.json(); })
    .then(function(data) {
      var btn = document.querySelector('.action-btn.saved, .action-btn:nth-child(2)');
      if (btn) {
        if (data.data.saved) {
          btn.classList.add('saved');
          btn.querySelector('svg').setAttribute('fill', 'currentColor');
        } else {
          btn.classList.remove('saved');
          btn.querySelector('svg').setAttribute('fill', 'none');
        }
      }
    });
}

function dismissArticle(id) {
  if (!confirm('Remove this article permanently?')) return;
  fetch('/api/articles/' + id, { method: 'DELETE' })
    .then(function(res) {
      if (res.ok) {
        window.location.href = '/';
      }
    });
}
</script>
{{end}}

